use crypto_bigint::{Integer, NonZero, U256, U512, U16384, U32768};

use std::fs::File;
use std::path::PathBuf;
use std::io::{Read, Write};

#[derive(Debug)]
pub struct RsaData
{
    pub p: U256, // primary number one
    pub q: U256, // primary number two
    pub n: U512, // modulus
    pub public_key: U512, // e - public exponent
    pub private_key: U512,// d - private exponent
}

impl RsaData
{
    // Быстрое возведение в степень и модуль
    fn modpow(mut base: U512, mut exp: U512, modulus: U512) -> U512 {
        if modulus == U512::ONE
        {
            return U512::ZERO;
        }

        let modulus_nz: NonZero<U512> = NonZero::new(modulus).expect("modulus must be nonzero");
        let mut result: U512 = U512::ONE;
        base = base % modulus;

        while exp > U512::ZERO {
            if exp.is_odd().into() {
                result = result.mul_mod(&base, &modulus_nz);
            }
            
            exp = exp >> 1;
            base = base.mul_mod(&base, &modulus_nz);
        }
        result
    }

    // Запись данных RSA в файл RsaData
    fn stf(data:&RsaData)
    {
        let mut file = File::create("RsaData").unwrap();
        
        writeln!(file, "p = {}", data.p).unwrap();
        writeln!(file, "q = {}", data.q).unwrap();
        writeln!(file, "n = {}", data.n).unwrap();
        writeln!(file, "public_key = {}", data.public_key).unwrap();
        writeln!(file, "private_key = {}", data.private_key).unwrap();
    }

    // Необходимо перепроверить всю функцию
    pub fn bpn_check(number:U256) -> bool
    {
        let mut s:U256 =  U256::ZERO;
        let mut d:U256 = number - U256::ONE;

        // Получаем s и d из выражения n - 1 = (2^s)*d
        while d.is_even().into()
        {
            s += U256::ONE;
            d = d.shr(1);
        }

        // Расчет значения ⌊2(ln_number)^2⌋ в виде floor(pow(ln2/lnE,2))
        // ln2
        let log2_n  = if number.bits() > 0 {
            (number.bits() - 1) as f64
        } else {
            0 as f64
        };

        let ln_n = log2_n / std::f64::consts::LOG2_E;
        let floor_ln_n = U256::from((2.0*ln_n.powi(2)).floor() as u128);

        let min:U256 = if number - U256::ONE - U256::ONE < floor_ln_n
        {
            number - U256::ONE - U256::ONE
        }
        else {
            floor_ln_n
        };

        let mut x:U256;
        let mut y:U256;

        let mut a:U256 = U256::from(2u32);
        
        // for all a in the range [2, min(n − 2, ⌊2(ln_number)^2⌋)]:
        while a < min
        {
            // x ← a^d mod n
            // x = Self::modpow(a, d, number);

            // Долго и вылетает с переполнением
            let mut i:U256 = U256::ONE;
            let mut temp_x:U256 = a % number;

            // Возведение в степень d - 1 раз
            while i < d
            {
                temp_x = temp_x * a % number;

                i += U256::ONE;
            }

            x = temp_x;

            let mut i:U256 = U256::ZERO;

            y = x;

            while i < s
            {
                // y = x^2 mod number;
                y = x % number;
                y = y * x % number;

                if y == U256::ONE && x != U256::ONE && x != (number - U256::ONE) {return false;}
                
                x = y;

                i += U256::ONE;
            }

            // Уточнить про ситуацию неинициализированного y при s = 0
            if y != U256::ONE {return false;}

            a += U256::ONE
        }

        return true;
    }

    fn get_bpn() -> (U256, U256)
    {
        let p;
        let q;

        // p = Uint::<LIMBS>::random(&mut OsRng);
        // q = Uint::<LIMBS>::random(&mut OsRng);
        
        // RsaData::bpn_check(p);
        // RsaData::bpn_check(q);
        
        p = crypto_primes::generate_prime(256);
        q = crypto_primes::generate_prime(256);

        // println!("p={p:?} \nq={q:?}\n");

        (p, q)
    }

    fn coprime(mut a:U512, mut b:U512) -> bool
    {
        // Евклида Алгоритм
        let mut r = U512::ONE;

        while r != U512::ZERO 
        {
            r = b % a;       
            b = a;
            a = r;   
        }

        if b == U512::ONE {true}
        else {false}
    }

    // Проблема с U512 и I1024/2048
    // fn extended_gcd(mut a:U512, mut b:U512) -> (U512, U512)
    // {
    //     // let mut old_rem = a;
    //     // let mut rem: U1024 = b;

    //     let mut x0 = I2048::ONE;
    //     let mut x1 =  I2048::ZERO;
    //     let mut y0 =  I2048::ZERO;
    //     let mut y1 = I2048::ONE; 

    //     let mut quotient = I2048::ZERO; // Частное
    //     let mut remainder = I2048::ONE; // Остаток

    //     let mut prov:I2048;

    //     let mut rem = U1024::ONE;
    //     let mut old_rem = U1024::ONE;
    //     // d^-1*e mod phi(n) = 1
    //     while rem != U1024::ZERO
    //     {
    //         let nr = NonZero::new(rem).unwrap(); // CtOption -> unwrap (runtime)
    //         let (q, rem) = old_rem.div_rem(&nr); // q: U1024, rem: U1024

    //         quotient = old_rem % rem; 

    //         prov = rem;      
    //         rem = old_rem - quotient.widening_mul(rem);
    //         old_rem = prov;

    //         prov = x1;
    //         x1 = x0 - quotient.widening_mul(x1);
    //         x0 = prov;

    //         prov = y1;
    //         y1 = y0 - quotient.widening_mul(y1);
    //     }

    //     (x0, y0);
    // }

    fn secret_exp(e:U512, phi_n:U512) -> U512
    {
        // let (_, d, _) = Self::extended_gcd(e, phi_n);
        e.inv_mod(&phi_n).unwrap()
    }

    /// Генерация ключей длиной 512 бит для RSA. При корректном результате
    /// выдает структуру RsaData, содержащую все данные для шифрования/расшифрования
    pub fn rsa_512() -> Result<RsaData, String>
    {
        let (p, q) = RsaData::get_bpn();

        let q_minus_one = q - U256::ONE;
        let module: U512 = p.widening_mul(&q);
        let phi_n: U512 = (p - U256::ONE).widening_mul(&q_minus_one);

        // Открытая эскопнента
        let mut e:U512 = U512::from_u64(65537u64);

        let mut temp:U256;
        // Проверка, что она удовлетворяет условиям
        while e > phi_n || !Self::coprime(phi_n, e)
        {
            temp = crypto_primes::generate_prime(256);
            e = (U256::ONE).widening_mul(&temp);
        }

        let d = Self::secret_exp(e, phi_n);
        
        // println!("p = {p:?}, \nq = {q:?}\n n = {module:?} \ne = {e:?} \nd = {d:?}");

        let data = RsaData {p, q, n:module, public_key:e, private_key:d};

        Self::stf(&data);

        Ok(data)
    }

    /// Шифрование с дополнением. Старшие 2 байта нулевые, чтобы m < N. Старший 3 байт обозначает 
    /// число байт дополнения сообщения до 64 байт.
    /// Пример: 00A0000000BACSA...A <- старшие 00, A - число байт дополнения, начало сообщения с байта со значением B. 
    pub fn encryption(&self, message:& String) -> Result<PathBuf, String>
    {
        let path = PathBuf::from("output_encryption");
        let mut file = File::create(&path).unwrap();     // Добавить проверку на создание файла
        let mut buf = [0u8; 64];
        let mut cipher_text:U512;

        // Короткий текст
        if message.len() < 64
        {
            buf[2] = 64 - message.as_bytes().len() as u8; // Число байт дополнения (включая сам этот байт)
            buf[64 - message.as_bytes().len()..].copy_from_slice(message.as_bytes()); // Вставить в конец сообщение

            cipher_text = U512::from_be_slice(&buf);
            cipher_text = Self::modpow(cipher_text, self.public_key, self.n);

            file.write_all(&cipher_text.to_be_bytes()).unwrap();
        }
        
        else {
            let b_message = message.as_bytes();

            // По 60 байт (text < (512 / 8))
            for bytes in b_message.chunks(60)
            {
                buf = [0u8; 64];
                buf[2] = 64 - bytes.len() as u8;                    // Число байт дополнения (включая сам этот байт)
                buf[64 - bytes.len()..].copy_from_slice(bytes); // Вставить в конец сообщение

                cipher_text = U512::from_be_slice(&buf);
                cipher_text = Self::modpow(cipher_text, self.public_key, self.n);

                // Добавить проверку на записанные байты
                file.write_all(&cipher_text.to_be_bytes()).unwrap();
            }
        }

        Ok(path)
    }

    /// Расшифрование происходит по обратной схеме шифрованию. 
    /// Считывается число нулей, добавленных дополнением и они убираются из исходного сообщения.
    pub fn decryption(&self, message_path:PathBuf) -> Result<PathBuf, String>
    {
        let path = PathBuf::from("output_decrytion");

        // Добавить проверку на создание файла
        let mut file_out = File::create(&path).unwrap();
        let mut file_in = File::open(&message_path).unwrap();
        
        let mut buffer = [0u8; 64];
        let mut text:U512;
        let mut padding:usize;

        loop {
            let n = file_in.read(&mut buffer).unwrap();

            if n == 0 {break;}

            text = U512::from_be_slice(&buffer);
            text = Self::modpow(text, self.private_key, self.n);

            let text_b = text.to_be_bytes();
            padding = 64 - text_b[2] as usize;       // ПРоверить переполнение

            // Добавить проверку на записанные байты
            file_out.write_all(&text_b[64 - padding..]).unwrap(); // Записать текст без дополнения
        }

        Ok(path)
    }
}

#[derive(Debug)]
pub struct RsaDataU32768
{
    pub p: U16384, // primary number one
    pub q: U16384, // primary number two
    pub n: U32768, // modulus
    pub public_key: U32768, // e - public exponent
    pub private_key: U32768,// d - private exponent
}

// Доделать encrypt/decrypt
impl RsaDataU32768 {
    // Переполнение
    fn mulmod(left: & U32768, rigth: & U32768, modulus: & U32768) -> U32768
    {
        let left_m = *left % *modulus;
        let right_m = *rigth % *modulus;

        (left_m * right_m) % *modulus
    }

    // Быстрое возведение в степень и модуль
    fn modpow(mut base: U32768, mut exp: U32768, modulus: U32768) -> U32768 {
        if modulus == U32768::ONE
        {
            return U32768::ZERO;
        }

        let modulus_nz: NonZero<U32768> = NonZero::new(modulus).expect("modulus must be nonzero");
        let mut result: U32768 = U32768::ONE;
        base = base % modulus;

        while exp > U32768::ZERO {
            if exp.is_odd().into() {
                result = Self::mulmod(& result, & base, & modulus_nz); //.mul_mod(&base, &modulus_nz);
            }

            exp = exp >> 1;

            base = Self::mulmod(& base, & base, & modulus_nz);//base.mul_mod(&base, &modulus_nz);
        }
        result
    }

    // Запись данных RSA в файл RsaData
    fn stf(data:&RsaDataU32768)
    {
        let mut file = File::create("RsaData32768").unwrap();
        
        writeln!(file, "p = {}", data.p).unwrap();
        writeln!(file, "q = {}", data.q).unwrap();
        writeln!(file, "n = {}", data.n).unwrap();
        writeln!(file, "public_key = {}", data.public_key).unwrap();
        writeln!(file, "private_key = {}", data.private_key).unwrap();
    }

    fn get_bpn() -> (U16384, U16384)
    {
        let p;
        let q;

        // p = Uint::<LIMBS>::random(&mut OsRng);
        // q = Uint::<LIMBS>::random(&mut OsRng);
        
        // RsaData::bpn_check(p);
        // RsaData::bpn_check(q);
        
        p = crypto_primes::par_generate_prime(16384, 8); //crypto_primes::generate_prime(16384);
        q = crypto_primes::par_generate_prime(16384, 8); //crypto_primes::generate_prime(16384);
        // println!("p={p:?} \nq={q:?}\n");

        (p, q)
    }

    pub fn coprime(mut a:U32768, mut b:U32768) -> bool
    {
        // Евклида Алгоритм
        let mut r = U32768::ONE;

        while r != U32768::ZERO 
        {
            r = b % a;       
            b = a;
            a = r;   
        }

        if b == U32768::ONE {true}
        else {false}
    }

    fn secret_exp(e:U32768, phi_n:U32768) -> U32768
    {
        // let (_, d, _) = Self::extended_gcd(e, phi_n);
        e.inv_mod(&phi_n).unwrap()
    }

    // Генерация ключей длиной 32768 бит
    pub fn rsa_32768() -> Result<RsaDataU32768, String>
    {
        let (p, q) = RsaDataU32768::get_bpn();

        let p_wide: U32768 = p.resize();
        let q_wide: U32768 = q.resize();

        // phi_n = (p-1)*(q-1)
        // n = p*q
        let phi_n: U32768 = (p_wide - U32768::ONE) * (q_wide - U32768::ONE); 
        let module: U32768 = p_wide * q_wide;

        // Открытая эскопнента
        let e:U32768 = U32768::from_u64(65537u64);

        // let mut temp:U16384;
        // // Проверка, что она удовлетворяет условиям
        // while e > phi_n || !Self::coprime(phi_n, e)
        // {
        //     temp = crypto_primes::generate_prime(16384);
        //     e = temp.resize();
        // }

        let d = Self::secret_exp(e, phi_n);
        
        // println!("p = {p:?}, \nq = {q:?}\n n = {module:?} \ne = {e:?} \nd = {d:?}");

        let data = RsaDataU32768 {p, q, n:module, public_key:e, private_key:d};

        Self::stf(&data);

        Ok(data)
    }

    /// Шифрование с дополнением. Старшие 2 байта нулевые, чтобы m < N. Старший 3 байт обозначает 
    /// число байт дополнения сообщения до 64 байт.
    /// Пример: 00A0000000BACSA...A <- старшие 00, A - число байт дополнения, начало сообщения с байта со значением B. 
    pub fn encryption(&self, message:& String) -> Result<PathBuf, String>
    {
        let path = PathBuf::from("output_encryption");
        let mut file = File::create(&path).unwrap();     // Добавить проверку на создание файла
        let mut buf = [0u8; 4096];
        let mut cipher_text:U32768;

        // Короткий текст
        if message.len() < 4096
        {
            let pad_len = 4096 - message.len();
            buf[2] = (pad_len / 256) as u8; // Число байт дополнения 
            buf[3] = (pad_len % 256) as u8; // Число байт дополнения (включая сам этот байт)

            buf[pad_len..].copy_from_slice(message.as_bytes()); // Вставить в конец сообщение

            cipher_text = U32768::from_be_slice(&buf);
            cipher_text = Self::modpow(cipher_text, self.public_key, self.n);

            file.write_all(&cipher_text.to_be_bytes()).unwrap();
        }
        else {
            let b_message = message.as_bytes();

            // По 4092 байт (text < (32768 / 8))
            for bytes in b_message.chunks(4092)
            {
                let pad_len = 4096 - message.len();

                buf = [0u8; 4096];
                buf[2] = (pad_len / 256) as u8; // Число байт дополнения 
                buf[3] = (pad_len % 256) as u8; // Число байт дополнения (включая сам этот байт)
                buf[pad_len..].copy_from_slice(bytes); // Вставить в конец сообщение

                cipher_text = U32768::from_be_slice(&buf);
                cipher_text = Self::modpow(cipher_text, self.public_key, self.n);

                // Добавить проверку на записанные байты
                file.write_all(&cipher_text.to_be_bytes()).unwrap();
            }
        }

        Ok(path)
    }

    /// Расшифрование происходит по обратной схеме шифрованию. 
    /// Считывается число нулей, добавленных дополнением и они убираются из исходного сообщения.
    pub fn decryption(&self, message_path:PathBuf) -> Result<PathBuf, String>
    {
        let path = PathBuf::from("output_decrytion");

        // Добавить проверку на создание файла
        let mut file_out = File::create(&path).unwrap();
        let mut file_in = File::open(&message_path).unwrap();
        
        let mut buffer = [0u8; 4096];
        let mut text:U32768;
        let mut padding:usize;

        loop {
            let n = file_in.read(&mut buffer).unwrap();

            if n == 0 {break;}

            text = U32768::from_be_slice(&buffer);
            text = Self::modpow(text, self.private_key, self.n);

            let text_b = text.to_be_bytes();
            padding = 4096 - (text_b[2] as u16 * 256) as usize - text_b[3] as usize;       // ПРоверить переполнение

            // Добавить проверку на записанные байты
            file_out.write_all(&text_b[4096 - padding..]).unwrap(); // Записать текст без дополнения
        }

        Ok(path)
    }

}


/// Модуль тестов запускать последовательно, так как пишутся результаты в один файл
/// и это может вызвать неправильные результаты и соответственно интепретацию результатов.
/// # Пример
/// ```
/// cargo test -- --test-threads=1
/// ```
#[cfg(test)]
mod tests {
    // Note this useful idiom: importing names from outer (for mod tests) scope.
    use super::*;

    // Предрассчитанные ключи
    // let p_bytes = hex_to_bytes("E6B42BCB8FAA28DDDC0600AB7AE17DA86C8D380C2D1F8E138190D2BBA693D411");
    // let q_bytes = hex_to_bytes("A23E4E6073B17209E8F56CFBDCAE306C196CEF4DEE779F2B69D74FA51F380731");
    // let n_bytes = hex_to_bytes("923629FB3D61C431E6486B96222C55EA6B5AB23D557DC723185F6632A4A07D39CD68C637A037E74023C8897CAE1D029EE2520741449F0CD0A3B3BC725FD00E41");
    // let pb_bytes = hex_to_bytes("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001");
    // let pvk_bytes = hex_to_bytes("89E0FE11E8BE8B6FAB03DC410614DD2864F870611A7FB40CCA6D1C48E1AA5EAB7314437E27FC2F1A9EBBB965A36B3FB00288F3A25FB50705B9CFC1889BBF1E01");

    // Выполнение RSA шифрования и расшифрования
    // let temp = RsaData{p, q, n, public_key, private_key};
    // let message: String = "Hello fucking WORLD LICK MY ASS".to_string();
    // temp.encryption(message.clone());
    // temp.decryption(message);

    #[test]
    fn test_rsa_short_message_encryption_decryption() -> Result<(), String> {
        let data = RsaData::rsa_512()?;

        let message = "Hello World!!!".to_string();

        let encryption_path = data.encryption(& message)?;
        let decryption_path = data.decryption(encryption_path)?;

        let mut file_in = File::open(decryption_path).unwrap();
        
        let mut text_vec = Vec::new();
        file_in.read_to_end(& mut text_vec).expect("Ошибка чтения файла до конца");

        let text_str = String::from_utf8(text_vec.to_vec()).unwrap();

        assert_eq!(message, text_str);

        Ok(())
    }

        #[test]
    fn test_rsa_short_message_encryption_decryption_32768() -> Result<(), String> {
        //let data = RsaDataU32768::rsa_32768()?;

        let data = RsaDataU32768{p: U16384::from_be_hex("DF63C01708836BCD57017EB8428F789B5AEE4A9708799849A2362F657ED4B747D10211D6C77A77576A3F28CFA1E67153FBA14001A9925C73741A067442EE56FDB532F56060BE7F16F5FE71BB01B236826F079DD1B7C35B7D74535A7CC0341FDF6A61A7EED3D8373BE07F95AE1241F7368752585744B43DA6C979362523CC1CDBAA89FC5ABFD28289C3562BD96E85197AE715EF419DD3A726442DA062FCA75A0B9EDC60FC8BB3527CBC9A6266B5B30453C7D86B9EA7EBC4F01A5B5031A5EAB31066C5310D5473E90F516D0FFD6D414EC55018D31E2E1EA1E1CF1C6D7B995D5C63A9C3704502EC3689640D197D8CC99E73E48153A7B6C1EE6813A6B32D3945C5435D3B1395B0105817E5689B8C057521BE7E3CB44101C35B7E0A76EC346B779ACD933975D546618E3C4A40D0D33BEF128F8775AE0EDC4D31B86F3D4F3F18A5295120FE8386356D1186EE28D430364492E33C4713B960404329AE2DDA326AAAC3756A824E202488AC8163723E2E54770F08827690011B486CF688565990F33056015181F9D58C786773F8BD66865B16F3F64B4FA66CBE388A74F63132D95526C1614B4CEFC38CEE345296A4472DEAECDB05069167C31B29FFF1FE4AD02DCD586D0AF73D884073BEB6BE28668ED7D0334F5F3E047D978C51C2FB6944BEC532300BF32A0CC2CDC63A8C5BFC7402AE1DCBA8FDC9C514B3DD438CED8A7C3B882B3AC3F2A93A90B62D129E1073EA4F9A0AEBC6D3E1EC700F5DD47B82741E520DDF2ED10C5DA27E8C4C8DF07A5B47838115F431ADE42E15659CAA502920B52676ED72E4DF105B09871B924420CE969F36E13ECEF3CBA897DC618D73BD84EA514767CE838830BCB53C7AF07C6C4C379D70EFB0510A39AC966C4C62F79E9E67A88699A16DF18F29E009E7FC7860B536E4492B6C44994D2CB5F730C77C797B25A8D72B49A533139A60653441D0D13A3550503FD4C6089D4EBBB3108F9AF7CD304B8525D9E72032A1F2B61871D994BD10DBDE8A735310EAFB9E1A7F2777D7650FF0733BC9ABA3892EA6C0F2E2EF785A5F542799F306A57345F39223EA45BC0BB6D3E3FC9FFF4C0AF628BA33BC0A5FC31891FD0046E6DC8F18950C6B033A4230F51F0E262F9EBF10B73EDAAB3A8A8B61947C2686297CA072422D205A8EF59A068BB41675CFB413D635F39F347F47DDC2E2C8A8F6FC778452280E5742D88E49716DA602465D83830C51B2082A8FB5109BBBD9FF131F8127ACA4A5A83446910423670B2F0AF105013F0461BBD0A1278E5329AB6E2A5E8AC1094DD46A02EFC23411BDB9C14B1B0BA00259A0796517CE758A961375715F1B475167BF97EA8AECD4D78B93C09E39A20A9DAB54A76E8F8A8B7037897F3D0C25B91150697E0BF56ECAEFBA0B3FE8C235236E07D0BAF2311AE20A20F16159E5A07716DFAE6E94929AD1D88E18603E177498F1F3906956B57920C0AFC737AF7BF8AC9EF904EED483F3654FD77A16775AC09C0C87C39F4077D32E1C88EBF79E5AAC695D05F19A410E4CB0E356086A05DA5C47F292C3A6FA27731395CBF0DFCE3EBAA74062F7BABFE03DD1DAC2DCCFDE2E3AEA201912318F7DEC72CE2AB40F11F2210EA1CE8B885E6F3B180AAF7DE0B3C9FC67E4E8C9E54EE8EDFB655FDC7B06D83398F8E4832B46F7E50D2D7ADDFA61861A3AC1099AE19369C710E9417C0530BA69E758F7189DE1A8A50EBFB074DD601F47B54DE854DC789A1DD9D68D6A9F78D0266CB0F7049D4AD5BAEF2C4B701B5657CB72C1BB7ED71C1155A33BFB8FEFEA2861BDC689F78F4D612A8A7DF9563EB8EA9D18223FBDB0590B261E796E9B595DF6CD6C34A31FF2BF4B38AE53D8FA5C7DB57FB26CD518C97E5162F5F5093E635B9CBF27316DAD70017C51909F6EF78FF654813FC597D00082D77B2CB2F4B26BF3649B9F93357FB9BB43176D25C7A284E1CC42EAEAEAE9F153670FA4FBD729C48FEAF3001DF401521441E713CF1367D455128EE2B7E79DF9E1AEE933CAA8A39C8464FA1C95D2D15B183DF4B02B9BD2392D987D8CF7AD53A8355EEB7648D9EE60CD65FA5CF2C5ACA0F52888C85946331A6E298C4F73AC6ACD0BA0BC3F6D69983E40B6BF5D308F3591EB43D622C8280448BD03A3815C318891ABE3474F5434A1791F052C30F85408C891961DF430B53DFEFF0B25A5ED5292EA7525BF96D423FF570D8EAB6A6FF74F5DCD479759874A8CA05897CA1E16BB210B24C7C55499A9184C6F8D242B57450941283C006E68F5752F9DB4D5B9D43F13ECC90150411E42F1D955264CF1215F7D40F52C3ADD0D1EC37B62203594B6539A3606B8A35EAB2064308248337CE20B2416DF6BDFAC0AD5EA99EA6512B9A5841B53C84D92D1D2B00386E28AFDDA0975B5719C516B31D0089FEDBB564690877B03D00FEEDFC8A9F633AC0704EA8F411A3235A133815217E4B1479EF686607F57354C55215AC1AF3BB01FE976BD96CAD81A2FE00012D9545AC264D73F5F10F50FA546167BD1CE23DC5F164522BF76353E820B6F5D24F56CCB1E6FA80337D5E1346DA8280F8D8F08176CE7B8C21C15DE437EBA4572012E535148F2D156FCD70E82F3BC039E46327ADA730F299B818AC1E09D3F708759FA595D8CB23B62CD1FFD4F95A69B45F6CBE57C288706EC0E4B8730F14C67A5301937F510425F3E56919095DFC27419F101A8540ED7C8ECCADA90772026CC280D0DBC161B39B09C5EE265CD43182A6A74F360F9368D113A2145C168E7904166A8400301D224A896DFB4E9B71280A1E39B4507149810FF1AF0E22B0A9C49896E122FDF18082F8D2C4569575B20B9AC42F2D12353AFDD72587571F559237BAE003E8F8F42EC25C91427F126D7245675C3DB3573062D2FF029935EBD5B00EC4CA06B3D016B50ECA4B19E6D"),
                                                q: U16384::from_be_hex("F92F72CB605AF06277FE5B47579CFD6F81A14D654935E6A88879D4D2BBB434CEF48110ECCF773815A5E054F09D2B2B939811C501D2C7CA3A2BB93C84780EAC74E6ECB7FD57F6994AB21A463782C84BD145626612DF7E5319D531471A60E25E195480EC153A41BBC3CA7B534BE868590948FA8DAC8D1E46EB7424200849AAD26D2CBF7851D604742DE9CE1598560AFFACF65E20C8AF99E3C85E63C88588BFD059327383162DD93B0D1A20648E2BEAEB5446830A6C8EAA1C7C95ACA781F3A4C1EDD615A28081CE772F4F37EEF9F158FDA6152953C77F258E428CF154D7CB27F43993F295E12C6843C70F179D62DD7734509053AAA98CB67A85DC80D7932654D81612516E7F300362FB1AD193D7A8BC974E32F091FF9B7291807B5EB711BC98C8ACB477A5E151FDE620C66E6286E2283A32EB567A2CB4F0F3185D54FED79759E37FEA7C978DF22915DBF9B26BA8635923C25E06F763CFAC37B5F0E9731BF57C16B7FBF1B7F71A035BE9D13FE013300709101A8FAB39976EFB0CBD4938BBEE2EBCD86CB6EBFE5E5E9EDC600D4C69D4E7419C2C4C1557175C97FAFBC25F3FB6680DC6242E7B61F9017A06963CD26CDF293ADF469F80641CEF10AE0360E75922DD6B1CCC407BD87E02638160DDB6FFD2994E708D7B53FE1A846570F9CC9EA22E7021B88469741DBBDF8EA6EAD3FF5B16256C5175E5E712347C8A1761E301E47B984FEB53EDF23D0D6B29B84B9602FD513044E30E82279DA49B24D76A36FF410D08E0DB48300FC3A7A86931C88C2822C1C4ABA4B3C11097CF41AB04DDE6ABA34CA76F3EE0EAE11B25D3BD70AB8C2EDA8EE9359D971672B93B30772783CCEC050637CAA65B92A352FDC7A1FAB412BD9F1ECFA4C39819358826298FB619F93C8169F683CE3440287F75518D0DBA0ACCFCFF326901F9FCBCB7B4A0254AD7A015D3CE75C64A3CAC532D36A6EB3BFB676A3ED711CC6F2C3736FDED3EBA270FEF714F5CBAB9A1B6DC8C7E872FB095BB0BCB6123E0D0128C9AC5DAEAB6A96E2A2BE6E97B313E6F2D23D88B999E0FE4E1671F7109171BB73041AE15B7E61D0555BD31FB469B076FD38237406837567DBE97444A298ED714039FB44F38BF19528606C5739D0C317277DE01C841D050DDCF9075BA548FB90C703C4D9C9ED40B7D8E4B8EC7C813758DFB294BA1F374F0213E5FD26AB2242C8F03AC014F105D92FD9194C35F0042DD985C26E28F94B8FE3FF6F87570B8DA92EDDD7792BE462A9891CDAB4E3BE1C331DEEEAAF47D000829DE79F508F9CF73F7A0C53D03FB68F26B2E4EC7FCAE52F08D76346D094795743B682466719FD24852B3C6243B2479746914A5B8CABDCCEC71917112DE94A17392555B98D809E471E97F74061B9478A182455048D17599A678EF9548A2D00D2A516A1844CB5970FD8E501605B3529FD471E63D35A13C3F0FC5795DCDAD2F1EEEA78EA4E5B0ACED88CBC4AE21EC6FCE42D95B7B6E5C55F22BBAF68A226028539F94D740C4736538A930D40D9FD84197B4AB2EA93C138475CB5B1107A5DED825C2AC1698C88CD39D21866B4374D2546ED6839184A7BE1564F2A4E2C6829D321E3994466466F3EA234171FA4D5E46C7E28F3165AE741236CB8D525A4E157D613725601E358B17B952405BCDD65453819B673657847CB1A54F78C8D59E01A44625F645765EA2B83352416CA0FEAEB5CDFE1191EB17BFE2055553BB064A120BE17815A4678A28DAE55ADD2773E0C841F997A5054145646E0E3FBBBE6F000D4A101A73E9DDBC1B69A0893BEE2208303890E1787D8C07FCC1DC24CC0367C33619B7A4A4BFF62F3E64F847BEEE2264D6145CCA4B3E5A4277BE709BD48431363027121604D21EBA31545C0E63552EA9394F7087658350F9211C3F9245E80E1BC200FAEF0A665BBC4CAF0506F1893300B7BC1E8A318562D85D4284171DE95DBDE3B65496DF11A4F47946B292C8DAC0B08101CA763A0EB8A8D653883895641C70B042DD0C4030951C2E354B6821A2E36CBF7AA9334A413CE1F45970BEF0C688ABBCC640FF6C987012E83589BF0935891C3BF54BC12126C55BBAF328DB285607B22B592DAE781E967A8FC5F584B11E055057404EEED63DA3D07FFD9623F932ED3AB57F96EA8DB121D09B1B52307DC417158C592C93C9CCFED89C2DBEC9E8B4978B0EBCC5087E76F6172AB1C8EF44CAD8F49EB1596EEC4DDDD02157CB8B8590CEDC47F9D1A74746EC39F9C45A920893470CD5C7A604559FCD4DA9002B354D0E58CA26D1B064A1B788E10F8F0010043698254EF5D00B4FD1EC79F10900822B78C4347A64BD234E4A3EE407695F1A203971EDBFD0138A45E44ADBDCA8FC64A0BD6375792ECBFF7C6785D82190DABBFB29D96071CCE50C14D062C2DE6B7BF5E87ABE265A0EEF054777E9E344C7AE68F03389BA90480626B68EC01FB7644C5335426978612DB8D8232E57343C13E602BA44F24ACFD4F31486099C97157D90FFDDAFEA38CB60522B5C388F11698365DD3771A18E5A38F77F044E89D601E2C13BE4C8E32DACCD37E0E4A8AE5D3F552BB0A9BE44555F3D45A1460C0B984B42F7E03BF0C6A05AA709EBF789ADAB8112CC223295F434B03B3202871AC8B181722DBD1B0C00D184FAED2DB4C6B3F64D557D45FD210FAA8D829F81FF8A6C16437489431FA7384F221DE61BA2D0D6399AF11EE7C3E3D911FCEC80F2DB2FD53FA2C95611A10E7660CFE3FC4861CD9464D9814D63D6B2B474EEBAF95B6B84118C6D911B2295586B997EFCAE07D92EE4B18E45C942D3CDB9BEBA0FE836413559C5C22962B9AF6D96D33F08F6DB37BC2E6C5BABBD1ED9A6DE0680E6D61FA600417B8CF0463493D4127947C53676C3FA77A24962DCA2FC46A7373D2725023F0035E757332A7007ADA9"),
                                                n: U32768::from_be_hex("D9716D528F3ABAE766D0147185961EC287A3940A5A15B8F31366D87E07200471643E4B9413E9F30E747B332B43687A05B9EF6FB027F013BB9DBC1D68C23AD47B9B8DDD58E56A1984F6BC0508F1F3D3B860B9810E93ACDFDDE894A4755E247F3C707A34D88BEA9D76D92D71A2C784CFF52E9129D0FA91258693E439B60A23F5B19346320F5C36E55FEE447210AB0A6FEB074C08540FBE71ACFB8E3A476913D524F29B53775E219FD94157D1CED90893D552470742E2F81EF02119E37288368037ADE17A0A0BAB3F94CB44982840F95E7F87F797639E6446F917B4181592B2314C2669C7945D8AA15BC0D83358CD60251FFF54FE7C9B832D5CD7913A6CD79100D325059BFC6F4FC320DA0A9F853BFC25AEB9EC069991E2C96693D238A7B35B87BAE0F22F8FAB052306753117DAAC204A1AB5D5E5CD6E588A7C15116954929DC4D5DEEA80543EAB8E14E2F563CE407AB499ED744B761246BB59D63E590021D0B24E597606A01094AE58E4CB04599E10134AB22B9C2DA34BDE19D9CDAB60DD3DA23B7DA2EBABE3FFF5493423A00A06F720AB02338C4544D47FB3FE27062D5F0CF0A2F07C699038AE910E55A119BCBAEE08745310C81666421DE93CBEA37E243622CBEE42A0C6504FBBBB54FAA2426F0C77C644E6265FAB574E9AF755FFAA86AA439A7F5D6C6E8C0328D710806B58A8FE8CFF75A3BC999A266508C50864BBA3FC3707F2E2E75A2A1A0B71028848DB48DFFB120FB60023AAD8C372DCEF77C94A1D35466985BA8FA8E9A4B2E6705643FA4AA9025363166305B62510A6624F3542951D979A0C880831766A2B30635CF605A340B195965155006DAC15F878222BCB2A338B1C0EE2DDA0489BAEDF9A6BAF306D7C143E594461092F98277CA0A227F4738F19E58ED1C7F51C89CBBB7636DE0C7170A387F6B052A0A5A5033147C5194EB155140A72C7FC54005E83FCCAAF91CBA57FD7A1A39E3B9D2205D2F9407646BCB1979A41F3A7F90FBB4D64BD56629E0CA000B1AE6BA4629AA4AB837985B32031B08BDD9067E3BC8DAD5B647B7CB3EBDE5E26446D23FE9BDA2A504B2CDDABFBDD74D4D815530559B967FE4744551763ED5DA36E78DEDCD03082EECAC498E5FE770B58BD42BBAD74C4F05A78D61386F0C0FA48EAF6A666539926050B4B56358D0396358A386388112AF204EB6DE1F6D8E2379D5D2E4CBC471A52BEAAB96C12E7742AF2312A30865600B7364FF2590A1FD70F6A39C7BEAF7290B6403A06E4F0A378B9F469C33955DB719FD1C375E44D2DFE2593BB6F4F5DA6450FEAB805B2768551994326E181CDA8422F21A2129B3C468B5AF362259E04142DA36839D9D61011382BEE839CA858FFC003F62464576E95F1BB91D405E7990CEA70EC1A7C8858F3DF0E9A646C92A912A8CEA43B54CABF19F9CA1048F26CD5E57713E9B21E6FD7BC28E60FF2B2A4A3F1D1F348501C49165750EF33446F7DE9529AEA28DD26C84BD76FE85484D91B4A1364B92AF489207936DA73E3B67CF62596B4183388BC92DF7C5AF5EDBA0AA48557766D480C6AB8735F6CD2B1B1CB488D8446A75C975424249FC3B0201C6D89F6BB9F5EB6FC91209D2552E7BE28D3A832AC6AFC9777252ACAC1A8C42184E1B62F661CB8F2CA8A8E67DE5252BFAFD1BC306BA0EC605A82A2864567E6A29E173042CF0CCBC90A5F5BB42717579DE979844D58370BB840C03B75C6B8E5AFA4B236306F78AD5C931099309F3832BE52F34F4C77B35D1CA77F9534416D741F75BB840006AABE1769013024CB08A9BA1428A9F3BA2A06F508851D5DC553EBFE0864F2E9376034ADA9C152E20911D409D29ABAF0B77E81293B26B442EFA0BAD24092A54D458A2EBACFF696B22B83019033EA413D02CE20193D8B760468FEE342556BD97AE18C9379A3BBB5B3C4E19A80EF4E02864B65ED3843F6C2E3CC18DE0AE9C3CEEC815240128F477740A56E599ACCF8C4EB8102A15C85CA7213897779400361DA4212D6D46F078C1F4937B045C1FC040D7075CF6B5190C0293A3BB8078602FCEA507F0659AC341A2AF5EEDBBDDB3E3707B080A4D1A3A95B8D3939A3C10B87A60375D96ABAA56286BCA8DD51EEBB2BD4BABB80A4D678F56026C0E69BE78894C855535F7E3CEE4FB4C546E4B7FA9D66342E062B6F1B43356F268795EE254272C02316DCBA62F4F14D336B259E5762FA69BB6C114AEDD49E0A6B3786586591093E035B9A47EA64AD72026C78EF58400A45D0F18CA8AF99F201B8D4F8C6CFC0757B689AD4AD9FDBD63596BB493670DD25585994F782056A2AC5A5E13DDE4092114C66E507064000A9D202FA9949518D0D8E016D65B1B51D2758DADFAACF36EA7A2EDD32152501C5950642AF37042DD14C2AF25C942FE4798D8362BC0748F1812C05A839FBF2CB4F37DD9DA4854D1275128810B74721DE2874D8EFD3A84E7E47C117BA6456C1E0F050304D9B8AF17195E39639EE0D458303F2DED326ED5EC20891DBABF12195D932FBBD3A71748844E0C1B5BD52ABA51EC80E517CEE45CCD5622FB4B13CE764D2058DFD7652D75DF75719A472896B5A1B8C9229FF446468D2C505ADC20370AA3439C351ACC05FD2C5C0A22A898DBDB5BFC465AEE1EAE4E771FA857B648ADD7369DBB6375F6F4408509AC0556C4145076B9D07ECE7818191E87674B3FAA1CDEBDF07C9E7A7E1B771AA4C011B43ACB2982E5F53AE254667C79EAA8089B680D27D115308F7DD92587EA0DEF6E6A558406BBD07B45807D630702423F73EED0B05F36A6E163416A2DE4E0BFFE539DF1859926FAE967EC6705929A9DAC99EA52E4C3D357B87C452D6B7FCA03425C11ED407891F66357967DA2552B7EB8D6F809A299667BB6F8FCCABC6C42D1B3DC3D4E51FEB6E6D6CA57F18708C30EBA2657DF3BFD725EF8C802595E4A392A77BC433AA3FC16605D5B4634B311645B1A73B343ABDD8D580EC0B19EFEC14CEDB5CDF145F901D388D7714A81BA02A0FAC09D10DF6713CA2143B34CC2241B18B7A319AB80C008E3FB1D8514BCD408CD7A9AB44A717644773BCD019248B619F23103E46194DC9E815086C707C4FD829279CCA639B160EA2283427834F7502657DC24FCEF88576EE79FA9FF064CA7540B73148EA762950D1326342089976D8B68BE28ADEDE370870529A00C3A2B8FAD690ABDDD60FCD9CEDC74C2BDB6C4C06D02120543FC977FD698CA7668663607DD465491BA848CAC702168B0D7030091CE417632171C4A272C85AA9A0093324B6A0D1040597BACE1C2713596E7D2606A7D7CCAB35AE0760659166F900109884DC45EFDD2149502A32BCB73250FDD7CE8CD4706A53C6749EE1CD99AF8475B62E4398F6EED0720F856359A388A403F7D0E7C691F30B080E42217DBB24204D75D33D1AFE30F4397DB1C5CCF4D92917E31230166B2A71E08FCE74E178B8BB4C9B03054AE917EC7E6DC9AC0E2377FFB15B2D4FC126EB4611DBA7C4F4D38A4E10AFC2B1D0A0DC3350F4A7F384064677149B505051337C18CF5AE774A3D8BD0CEE09137B9C02616E316A4FCBA7B0C9EFF53326CA03CB0A54DB9D1FBBD13CD000703F0FDAA7C11DB22CF74FED49833B819ACE6513D3115BB53E89CFFE14389A76B76D84DA59D2F7A57EF1431282961A945A67FEC171E9F2955F9FF9DDFA790143B4F316F6BFED01FCE15B95B3F1373096530FC063F1B527F8B2A6AB53FF0D1E65B84AA1020D54B7169D396B6F95FF879DBD73DD3CF9A71C54A7B41C9DDC126B29077BCC3B0D8F56B62DCF7A179597A1BE449461E666A9072F2C9157BD5806F64BD89B209353DBD869089145D78858263CA5DEA30828CEDCC87A7FE552FE84EE667F34A10FCCECF56C2DFABFA565C93C7C2C9A0BBF877F640B4134C034B61DA9DB3AC359C7840C69EF8E9D19705437A65895E6C6AFE34FF1FFE69B24E831536F1A13576292E1A8E7CBEBF4CD5254204F4A4E2377EC47CF77FD6AFC05538D75C1FEE68F895CD3FD684BD1790D19C9A08D1B825A3F4AABFF711585B07019E3A05CCE280B2F8763F34AE2BD12A7E4F14D022708E0EB5B7FABBC34E3F5BFFB55B491EBA7AD631DC78F129747EF00597FCC51A7CCDCDA10794B472B6AD05EF6C6B12D146D9D3F736848403821A2269D9A6C010C6BC7E8648815CFF50E5E4E465A14CA992A5C469EB13D33DE615E5A1E42DAAB9E389E56CE2F1AA428FEBC1FDD7DF1EB6F6DE482C91838C8625FBF5BA27C535D75DA2CF2CD4420462474BC2AF8A0A20D81EB920AAC7C416CCBA5B53AAC5BCB17F73A03AE01E770A3BA7606DA2446037C125E0B3A240EDD1B21EF3DCF15FF4ACE0F7308A5A8B956C6282011ADB9FB80384CDD7FCDA6DB8EF3E4032C3E6554480CD972698D96D9AD3D430CAF7BAEDB81DB86D23D94EDBE6BD5641AC2A6FA4F3171A7BBF6ECF36A686E7D561CD52CC0B471FCB7DBFFBF778E3C456DC19750586CD4879593E2B6FB4A7B4A5660EBC8AB1EF3D09B27302160BDC256EF502B14E4AF5F36DC86E81AAA2AF3E98417F746208AD8DE6C13A61691AE480C324275C228758E5A9379F575CD08A324E9EB535BCC4A4953F358EB22B5357D9789DAC475713FB3EF4A72BADB723A6D36567742183F6E7E35CC1DDDC42F8968A6051045C36B33711911A959C323A99FE07465AABA5758EDCAB16CA1E1F47D84CEAD5E83FE1E22EB8198FCC25F8E601ECD778399096E209F96DEB55189C6BB7A8B069FAECE68AF85D3E473351857AC56AE3D07D6E91038D64374ABF3F13A2A2030C989A546CA89C331F98656D7E5743BDD895332D8D42EEF575092C2A5DF614C814B4B6AFD3EBE16BDDA63C2E83A20BFE2A3FEBE3A24CD0A0955C5B79F74326C423D041DEE5EFC636804EA080BC465D957A138D9484172CC06780FA3A5AA349EE0F8DDCDE1B2226F2654876D0CCEAC5F0C9A1B6A89284B649C18F02F04860070300A77C30DE9423CB842F354FF562BACED53CE50317BD4EC8FCDE35C84DE19AA7D2B93E29D0EC77AB7721558AC13D7B640B21AB584FDBE79A69A227935B9B7639CEEC22E3B2AC5B77D3A24404683E9DE1B1FACFC8A70A08FF1153419077E9961672C9C20A43DDDC17AFD72A420AB36776055402898A19C22722B881377F4FA9DF1ABE1E1749BEDF04C00C2F578EEE96A7A4D2CF208CB26CF326B4AD764E530160EA9C1D6CFCA57B4422234F393A80AC2E61FF6F52AD507E8EC8BFC0DDA5184E5E2FFB259DB811AF68B3A15A9CF44D8B045FF37C634EF32DE0BD8978E8B6F672BA318F523BB04205762941642DA9A77C152566340431B2720CEC6B716D452B9A5E010177BB159D5A42FD622CD19042C6DBE4BD22FCB414747F132B65EF92EF7ECE39C670AEA2F8B5B49DA2BA8D71843E6288483C2D9AD92CB7CF318A7B24AF532F750A3428E57C6C791FD89552A78330726F62C31147918B0A4A714D8CCA3C9AAA6E70B65BA80EC843B44B02B64722DBADD169E5374578A8F28A923D7B6133E33B095B40A4A2A7BA26BE2DAA29D547318993F6B78B3C7A755316B2245FC1E65CA3EB284D2972D856111F83474EA8E4CE183F5178A4014C0297BD572674E6DD8EBC84017C2FC7A1928D2D5602348A8E25A245CD0538C734098995BF0460B4846E87CCC7E792C8DE4E9AE172912C8ACE75DF07A715AF79A9E743AC64E9A6CBA7B77CB3206606D461464B8F16DAA9433A66608CCB024E46CFCAEBF37C1F7CC74F197950040D12B8715046DE8A9D92E71E028CDB693EED01A5AB4BACB881223657B034318831B0337D3FBE561DCE1FC315D042504E6D08F33047916CDCD4291C64C3EF5"),
                                                public_key: U32768::from_be_hex("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001"),
                                                private_key: U32768::from_be_hex("4EB174251ADCE0637A9BF7AA15F47C715E715ED45841E04B684C22318A1696450B485845E0E71C25B1161D309D16A4828A06135FA734858FB2C82FC487F68E8BA5823407460F9DE8B6FAD8BFA200E230AA20B88A33FBAE913AE90093D15C5807E194F8A71E0BECACE47043DDEB632F77C64096E7A0A702F3AF763B449C6AE3323EE07AA18078058F3045E91A0B2C9DD06B35A315F914AD43334F07DC6C34D740A5E47CD2886896D72384CAD3974C39644C80942A2AC62D3C2E5E96280F0FDA5B4C3C7BD442E0D903DA849AA486CF38D9E2B5423EB546094180C896A6C80E6134F3F9F856C37BB665E466DA3E5B255E8A33F7E899E4161746B06548C5B7462D0C3D2BC886152AC2AD92FBA13BB0B7D25367C9F9A17E609B0EDA948C18751ABD066EFE7724017ABC704BDD568AB71C80752635A11335CA29643AA3B0810106C403BAC7176665BFE48DBE8D9C6F3A7AADFDBF28055F57C1ED6FD7CF7C9A45A2A7C51F2F4DBA8405AB0B54D1FC630A873AD41FA314C497828F80BF88656B8AE6115E825B81FB156ABEB49D7FFF1D61E3F218B19542409766684915C3BDC291D1B70CE107C594824EFB043B0D30A952E56E7DDACA09FFC1465058E6B8FFA65928967343692D9257E26348AABA821A94E1E83F03145FF2E3A99733122C3778D97FA933B2C076CB933459856BDD6DFC0A3D057E366EE984957B2BB97EC548DF77BB819708DA016C6A2C3ED3C95CD53137308846C314D4FC138A9B41689FE9B4197474A164F316CF830BFBA51B2CB0ABAD5B73CAF9AEB49D65A5C3C840CEF767890F3A447165F39D33796D76EFEE25E88BA5C775FD73074042056EF00C9A3D93A7D5400E2A3B60F3605CA6AB251557BF71414E546D34154120F7EE92EBD19E9DE3242737F2123BEDA7D18A350745031A5D5A78AF56377B1C8C332682FF44C01A26969AF9C3C64286194880EC37828B03B2B5D48C8F5D0D98F98724A073C0568DC72066835736FD2570021342501B81593DAC7253DB91ED4E1A355A351CB7BC59FC61AE5CA3345601192D12144D749610D8CB2E0239957B41A0350C1608C8B8C35024461B65AC441572BA261658AE8AE689330840A4D1D30C2D62555560CD0CFF88C9BC75D23EE5C98AB489A98DA04787BDEF5690626F5A3D0B01ED7566F06E34F885561F0DC547AB1EE5B3CE18585CE3A50B07927F7D19EE89A2448AB8CC5A1315C1AD2109E9C1D442320C1FE6CF3E90C35E3ACD6A72A2404E0B073778E3460B83579912E5AA4C5E3CC2E04162DB1AEB783CD538525260CC19D666D5EE89E5C6DDFF1F8464BC7B57578C83198AAE4FA4202EEC422AE70306E2756EF4F0D73DBD5D9CD8971D0CF818A6BF48476761150E830BA4FD1C9DF28FF010AA01F3EBCC7585D65D1DD70544D711ECA71729DAAE4A9252048EC1DD8D939C02C2E2C98D24805E34D4B4BADE46CEEF72A24B0BD18F9A4E1A236DB303D87B22C177C481929F8FFA5A14AC777E1ED2E1F2F98EC249D4547BBED13C6C01111D775402E28B8C840117524594BCE149B89B8D7533B933C3DD571EF15C2CFBB6EB963E5F8E0CCF7FC9AA22859C843017F152FE0E2F5DBE75E0DA1E307DCA0BE73AEB053B33CD69AD3365068632F714DE16907286BBB2655345EC793212494F581EBB809066713CAC6755F0EC0D56CB0A82B058D80B3EF38B41527B4D14FFFB579A8361646F5AA2AA3F1F0F50FFC3D744B432F25ABC86974A3775393814012643C056536E59581D016A645850426578A221C78D401FAA64680C6AB83235B579BC5135808B11684B767241AAF8A6C511FC41243A2C577135B3C42085A2806BAB180EF063822E7C1564DC20493C6A4E2830CCE7F37D7C61FBABC37F88034E268B31AF6035D1ACAA5A2DC269EC89472CDEEA4FD27654E162BFA1ADB1101F757BC002262B5F2CABBC145028BF1F2CC7E92B6C006969F2CD93C99EC5C028019408BC0B970702AADF68A2DC5B35B7D5E8E372FFD29D99080DAD326D67100E4EE40BFB6925D9C9371DB1CDB9DB7F008A096ECAC613129345751DBB4A820558B28DD3909EDA0FCC26F4D5C3486089D905793425B072DCE36B933ABBF04918ABD3654B79C0FE0FA9E6E0B6C98FAA65E5E75221267023F125D0015CA4C0C169ABF366D79F887013A7C42D046AE74AE582EA8768EDCA0A5C12101F7C170DC1F18A22B209ADE0B06973A52D050C446E0473CD8790BFDA58FD89E0A1BCCF0FBEBCB02D8D0A335217DBBCA1742A17604C20777369911E0C5AC7F340B64772A3991D70BF3812BF68E022581F521771AF109AECB770373C4DCABB0252BB22DC1D21789D60F4F4DDA35FD86E797C91F5B458B6E162FE9113505AC2A7DF7FCD6238D32A5A0293143FDE2D6B1FBEB5EE44BF53CB9C4B69492AD6C14DDF326E3F701BE87A3A21D07119CB9A9CB12FE709D3D1BFE9985E138DA8D1436CAB218D83CDB26B18724912B27D889F98F68F69482716C17537B7AE41D7FA4E7352C5D6C166F3447F449E2ABCC125B824EBFCEEE1A2DB00BBDEC5C80A16D2B9D38D06A19A8745F7D773FA3BB77E14299BD4B88CF55202C86BFF4B7A80A5E464D3D44ECB5735B3F179F04384ECEC1735FF1EC5CF1EF977EF1BABEE447CA1A877F89AE8FF0B0F28CF704AEB968BD3BFD3619A1A9C91AA3EFE4B75DBD8E481E2290A220F498CE2FF174AB59D08117BEE763C091C4AC68D8AEB681D0E0BB2CB2FD7FD97557BBB689EDC1407D8697693845ADC22EF34DF5F06AF45066F55BD9A401109450D4E4FCF9965E6CD04F14A7E68EB91C9855FC5C5BF472582E9416A7ED1409A2E4EE495B27D2EDCE885B6DC2B7204C02572F20B5C0060DD8CDE5CB36BD15F17A5B6F9EB0AE167EFFB7B0E615F1D04EE496AA4954867E9E37298F3E3CBD9BCC97A71E46BE0021E23C6AE41F43336C0DD1F2BB61151A66FCDE68581807674FD06F7920BE87CD6F0F24BA8DCFE48DF62619DDB8931150ECB99B120FE88136CB2F95DBCCFC0D1F5B96DCFE4449462CD2081C4F01C8ADA13FD1E982C5E51770B2CB9D4BAEB09D35B8932C6D88518D0BF05BB6C9B174EADCFA17087C2634E0B04E2DD1E51A3B5D8B0B2B8EB09FB00B7355FF8F0ED4337AD36729E1F9A3ED6B338FFFDC2F093D6C886D3676E2E26D3DB5E48C6AA7C0A6B05E8C90554F92CF6DF6B5826E4DE155EDE5E0F26C0EAD42CB22830F4DD2CFBEF224939867F82090E3CCB98806DE76CDE0F48D5C62A56D8B05972070776727F81FCE6DD6E4067EC0A26A731430AA39EEC98D5B13F756A0A5767FF6A3C4DBBD09B0D6862D1B0DCF009F02C67D52744019164CEB60DB436B52F979A491332F6018B47068C7A4BABA8A8D131A033B70FE96669183E6BC080531CE32186173AA19A5D00AC6BF786934B25792C7EE1DF211C77AA71BD77665AEB9F3B9CE2C3A506B7731F706DED141C3DEAFDB92FB1A6AAC610C148E8693A5878056CF8D6771E38ACF4669B17CECA779A43218355F18CEFC472E6BB81FAC23308F1CA8D30D1BBEE85050DCC87C1DD26192D13055A49E9D2A5808A5532A2D3B1267EEC7C29E7D27AF763C593FD9052654B9460D852027F135987532D68DCA9EB90622AF696C69E22C3FDFECEEEEE8719424CC00077D1B9ABCD2FE484343EEBE38FC0A218AD2C3708B1D810054675A1FAB79472451074B1E7159DBE9AABE33BA130781ECECCC4368BEE50EEE8C6917561F82912D91C766F9149C2DB0528767C5E7736EF927515A6593D42689469DBA6D6456FB7556B5337B8EACE36143F626C8A73B74E4EEA87D245727E6154C758671A854C17A56232C5599607C1C8E4B23F71F363CEF77257FC788D809328AFE0956C83DC0C9B0A0B6D504DD8695906B4D9398FAB12C221D7842E60756B0F140B05F4F2E5FD2B484C54BF221979DAE2DAE9FEB55C20564C06CF7739600E2FD58CA0A7606DFEAD49FE32B3D4527F035FDA13E8A76547C402912A0E4BCF6E63A9FFC7B95345588B4EEB52EEDE0993A2A9B863AB07C63EF49689BAAB8FF450DA8FD0D85638E78C32E07B760D5B4B462645B2886B13B1A41E953107FBE82461060EB89E5492F13399685BF2436709386B6F474F06F36234E5E771C3A843D13EF4165FC3C74537E5C9890103C7D02201ABAB76A07ADFAB97D71ECC6B058C8B212C0D3E256D99F9CE6F148CBD3BAD0300901F794CFF9C7CDE78C5059458ED94572891815BF4F0152BDC0486D94271A1BFC7157E663DA4CAAAF3E9F8EFD28E01ED6E50C5B42614C907E1D34C39B5AF2A76BA48432B457FB941B7A7D35E9AF84B322FCE205ACA554A20FEAE516DAAEDEAB2EAA5A1548806783B21CB89129CE91D57FDD0BAD5C3341740B46B706FD6BA6926202BFF33E175D765C4A0BFC742D37C161105F15987A601AE755CD8C5D592C3BB8D185F8357E5D02BA716C2BA6BBD3EBB610D72FD758DB54A6D7F827A1B75101F81C9463E388F974C35BE513DCC7227DA5A10058F8F94F10D906E543C64730A1D4DF64DC4717515AFFC1257B3144DF2B45CE1911B94E0A8D75E1334753595CDDEC34F92CBE1F93CE437A77DD4B52D0F76528E19EA41068601D0768E030D2CE12FFF9DDC03C4B877AE09B4EA75EE09CEC5363947DBEF4A65EC349445007F38643BB4A9D07CBA9866C85D194FE45090B05C7A60B11A9DCB3C7F55D43642A3CB1E6FCABAD9432462726161EC781010E68C37B86B613D7643ECDE9DABDD3161F8ED830FFA90D174D68074D077CB77DC0B0C09EC5F68C74936CAA7C3A4875B2525888BDF0E152FB656AE6A78A5C16AC816AE5F9A32CBF8F2A4DAC4AB3DD78C225D90C6428BCBB46165F0CAC56AF24FA847C664D791CA501D870F924445C0E76D0A41DE4C3368496D544A36C1BDD45B84B03CF97B156A95A666F4DF39A859D552219BDEF9DE5751DEE67BB90E287B54D0025D9583E138051F1AF70CC4981A0F9557B1D9E5AF664B26DC8893A2C614D00D6642E72B4794B6B0C2C1F49109A2A80808B1D8EA4EBBE452922730878FB9AE77881840E00BB827DB8C581361B5FBA4A7F79188A284E6341201FF4112F8D0E1365512AC1896C27C836C1E63E2D790F1C24BE298CC0B0511A3877BB9B8F123A813F0C46EE6BFF122826CA5134AC00A64DA17095FC25BC70E318EBD54E854A875C92753BFC74369CCFA1E036664E6323C58E6A9895687FE47F5E67E6475612FC0E60C6E6DAA42A838BAD6E834B489BD69ECC946C10AA2A72CE9D215C1C64A3482C293ADEF76BB5BDAA02ADFFCE0EE036A26061AE1D65AC6A36B3B4ECE81AF9EE01C9571C6EB3ACDF211E263B33113ECADD21ACD55C85CB67B4601C7FE7700D3A55EE0FDF34778B2061752887D051A2636C73F1D2981B809C1544B90ED51B3A148EBD7197863029AD23043C1BAC205356ECF5ED8D3401FC3C5D3C2704559C783724958CCF00B21BCD1C893E1557168DB5E2BABA337529C171543515B203E71CF9AFF970D5477A3C5571CE71E4FA0D03418949829C1BF00A1EC4577E3C1EB99D5CFF5F93C315CFCDCE3122A050AF6F90F5BF5529DA240749859A2528A50257A94973B1351612B8EB66168DC54B8944B8857A49551A1326D29EB9FE60E2BF32435EEB6D04C05FEEB9B58B70E146AB531302D3DE0EA32DC79B60F98A25D87096E1519E73489BD42D4AA4EFDF5A18A96BC980C444D6CFA48194B5771EA403D83D2F6513AF6F2919AF5D753E903CC46A1FA2BA309240463B32ADF775DE1EABFF7E7958F01D574FFB5C1087C20F56176B147E47C4CA0B763B5B1888AE25D97A33FEB3FB40139BD5CA40EF750FD41")
                                            };

        let message = "Hello World!!!".to_string();

        let encryption_path = data.encryption(& message)?;
        let decryption_path = data.decryption(encryption_path)?;

        let mut file_in = File::open(decryption_path).unwrap();
        
        let mut text_vec = Vec::new();
        file_in.read_to_end(& mut text_vec).expect("Ошибка чтения файла до конца");

        let text_str = String::from_utf8(text_vec.to_vec()).unwrap();

        assert_eq!(message, text_str);

        Ok(())
    }


    #[test]
    fn test_rsa_long_message_encryption_decryption() -> Result<(), String> {
        let data = RsaData::rsa_512()?;

        let message = "Вино губит телесное здоровье людей, губит умственные способности, губит благосостояние семей и, что всего ужаснее, губит душу людей и их потомство, и, несмотря на это, с каждым годом все больше и больше распространяется употребление спиртных напитков и происходящее от него пьянство. Заразная болезнь захватывает все больше и больше людей: пьют уже женщины, девушки, дети. И взрослые не только не мешают этому отравлению, но, сами пьяные, поощряют их. И богатым, и бедным представляется, что веселым нельзя иначе быть, как пьяным или полупьяным, представляется, что при всяком важном случае жизни: похоронах, свадьбе, крестинах, разлуке, свидании — самое лучшее средство показать свое горе или радость состоит в том, чтобы одурманиться и, лишившись человеческого образа, уподобиться животному. И что удивительнее всего, это то, что люди гибнут от пьянства и губят других, сами не зная, зачем они это делают. В самом деле, если каждый спросит себя, для чего люди пьют, он никак не найдет никакого ответа. Сказать, что вино вкусно, нельзя, потому что каждый знает, что вино и пиво, если они не подслащены, кажутся неприятными для тех, кто их пьет в первый раз. К вину приучаются, как к другому яду, табаку, понемногу, и нравится вино только после того, как человек привыкнет к тому опьянению, которое оно производит. Сказать, что вино полезно для здоровья, тоже никак нельзя теперь, когда многие доктора, занимаясь этим делом, признали, что ни водка, ни вино, ни пиво не могут быть здоровы, потому что питательности в них нет, а есть только яд, который вреден. Сказать, что вино прибавляет силы, тоже , нельзя, потому что не раз и не два, а сотни раз было замечено, что артель пьющая в столько же людей, как и артель непьющая, сработает много меньше. И на сотнях и тысячах людей можно заметить, что люди, пьющие одну воду, сильнее и здоровее тех, которые пьют вино. Говорят тоже, что вино греет, но и это неправда, и всякий знает, что выпивший человек согревается только накоротко, а надолго скорее застынет, чем непьющий. Сказать, что если выпить на похоронах, на крестинах, на свадьбах, при свиданиях, при разлуках, при покупке, продаже, то лучше обдумаешь то дело, для которого собрались,— тоже никак нельзя, потому что при всех таких случаях нужно не одуреть от вина, а с свежей головой обсудить дело. Что важней случай, то трезвей, а не пьяней надо быть. Нельзя сказать и того, чтобы вредно было бросить вино тому, кто привык к нему, потому что мы каждый день видим, как пьющие люди попадают в острог и живут там без вина и только здоровеют. Нельзя сказать и того, чтобы от вина больше веселья было. Правда, что от вина накоротко люди как будто и согреваются и развеселяются, но и то и другое ненадолго. И как согреется человек от вина и еще пуще озябнет, так и развеселится от вина человек и еще пуще сделается скучен. Только стоит зайти в трактир да посидеть, посмотреть на драку, крик, слезы, чтобы понять то, что не веселит вино человека. Нельзя сказать и того, чтобы не вредно было пьянство. Про вред его и телу и душе всякий знает. И что ж? И не вкусно вино, и не питает, и не крепит, и не греет, и не помогает в делах, и вредно телу и душе — и все-таки столько людей его пьют, и что дальше, то больше. Зачем же пьют и губят себя и других людей? «Все пьют и угощают, нельзя же и мне не пить и не угощать»,— отвечают на это многие, и, живя среди пьяных, эти люди точно воображают, что все кругом пьют и угощают. Но ведь это неправда. Если человек вор, то он будет и водиться с ворами, и будет ему казаться, что все воры. Но стоит ему бросить воровство, и станет он водиться с честными людьми и увидит, что не все воры. То же и с пьянством. Не все пьют и угощают. Если бы все пили, так уже не надолго бы оставалось и жизни людям: все бы перемерли; но до этого не допустит бог: и всегда были и теперь есть много и много миллионов людей непьющих и понимающих, что пить или не пить — дело не шуточное. Если сцепились рука с рукой люди пьющие и торгующие вином и наступают на других людей и хотят споить весь мир, то пора и людям разумным понять, что и им надо схватиться рука с рукой и бороться со злом, чтобы их и их детей не споили заблудшие люди. Пора опомниться!".to_string();

        let encryption_path = data.encryption(& message)?;
        let decryption_path = data.decryption(encryption_path)?;

        let mut file_in = File::open(decryption_path).unwrap();
        
        let mut text_vec = Vec::new();
        file_in.read_to_end(& mut text_vec).expect("Ошибка чтения файла до конца");

        let text_str = String::from_utf8(text_vec.to_vec()).unwrap();

        assert_eq!(message, text_str);

        Ok(())
    }
}